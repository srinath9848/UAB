@model UAB.DTO.ChartSummaryDTO
@{
    ViewData["Title"] = "Rebuttal Charts";
}
<form asp-action="SubmitQARebuttalChartsOfCoder" id="form1" asp-controller="UAB" method="POST">
    <div class="container-fluid">
        <div class="row">
            <partial name="_InitialData" model=Model />
            <partial name="_QARebuttalChartsOfCoder" model=Model />
        </div>
    </div>
</form>
<script src="~/dashboardassets/libs/jquery/dist/jquery.min.js"></script>
<script type="text/javascript">

    $(".CoderDetails").css("pointer-events", "none");
    $(".CoderDetails").css("background-color", "#e9ecef");

    $(".QADetails").attr("readonly", false);
    $("#qa").addClass('selected');
    $(".QACorrections").hide();
    $(".CoderCorrections input[type='text']").css("pointer-events", "none");
    $(".CoderCorrections input[type='text']").css("background-color", "#e9ecef");
    $("#divChkAll").hide();

    $('span i').click(function () {
        var id = $(this).attr('id');
        if ($(this).hasClass('fa-check-circle')) {
            $(this).toggleClass('accept');
            $(this).siblings().removeClass('reject');
            //$("#" + id + "1").css("display", "none");
            //$("#" + id + "2").css("display", "none");
            var title = $("#" + id).attr('title');
            if (title == "PayorID1")
                $("#hdnPayorID").val('');

            if (title == "ProviderID1")
                $("#hdnProviderID").val('');

            //if (title == "CPTCode1")
            //    $("#hdnCpt").val('');

            //if (id == "Mod")
            //    $("#hdnMod").val('');

            //if (title == "Dx1")
            //    $("#hdnDx").val('');

            if (title == "Feedback1")
                $("#hdnProviderFeedbackID").val('');
        }
        else if ($(this).hasClass('fa-times-circle')) {
            $(this).toggleClass('reject');
            $(this).siblings().removeClass('accept');
            //$("#" + id + "1").css("display", "flex");
            //$("#" + id + "2").css("display", "flex");
            var title = $("#" + id).attr('title');
            if (title == "PayorID1")
                $("#hdnPayorID").val($("#" + title + " option:selected").val());

            if (title == "ProviderID1")
                $("#hdnProviderID").val($("#" + title + " option:selected").val());

            //if (title == "CPTCode1")
            //    $("#hdnCpt").val($("#" + title).val());

            //if (id == "Mod")
            //    $("#hdnMod").val($("#" + id + "1").val());

            //if (title == "Dx1")
            //    $("#hdnDx").val($("#" + title).val());

            if (title == "Feedback1")
                $("#hdnProviderFeedbackID").val($("#" + title + " option:selected").val());
        }
    });

    $('#btnsubmit').click(function (e) {

        var Dxcodes = $("[id*=DxRemarks_]");
        $("#hdnDx").val('');
        $("#hdnDxRemarks").val('');
        for (var i = 0; i < Dxcodes.length; i++) {

            var id = parseInt($(Dxcodes[i]).attr("id").split("_")[1]);

            var res = $("[id='Dx_" + id + "']:eq(1)").attr('class');

            if (res.includes('reject')) {
                if ($("#hdnDx").val() == "")
                    $("#hdnDx").val(id + "^" + $("#txtDxCode_" + id).val());
                else
                    $("#hdnDx").val($("#hdnDx").val() + "|" + id + "^" + $("#txtDxCode_" + id).val());

                if ($("#hdnDxRemarks").val() == "")
                    $("#hdnDxRemarks").val(id + "^" + $("#DxRemarks_" + id).val());
                else
                    $("#hdnDxRemarks").val($("#hdnDxRemarks").val() + "|" + id + "^" + $("#DxRemarks_" + id).val());
            }
        }

        var CPTcodes = $("[id*=CptRemarks_]");
        $("#hdnCpt").val('');
        $("#hdnCptRemarks").val('');
        for (var i = 0; i < CPTcodes.length; i++) {

            var id = parseInt($(CPTcodes[i]).attr("id").split("_")[1]);

            var res = $("[id='Cpt_" + id + "']:eq(1)").attr('class');

            if (res.includes('reject')) {
                if ($("#hdnCpt").val() == "")
                    $("#hdnCpt").val(id + "^" + $("#txtCpt_" + id).val() + "^" + $("#txtMod_" + id).val() + "^" + $("#txtQty_" + id).val() + "^" + $("#txtLinks_" + id).val());
                else
                    $("#hdnCpt").val($("#hdnCpt").val() + "|" + id + "^" + $("#txtCpt_" + id).val() + "^" + $("#txtMod_" + id).val() + "^" + $("#txtQty_" + id).val() + "^" + $("#txtLinks_" + id).val());

                if ($("#hdnCptRemarks").val() == "")
                    $("#hdnCptRemarks").val(id + "^" + $("#CptRemarks_" + id).val());
                else
                    $("#hdnCptRemarks").val($("#hdnCptRemarks").val() + "|" + id + "^" + $("#CptRemarks_" + id).val());
            }
        }

        var total = $('.CoderCorrections[style="display:flex"]  .fa-check-circle').length;
        var accept = $('.CoderCorrections[style="display:flex"]  .accept').length;
        var reject = $('.CoderCorrections[style="display:flex"]  .reject').length;

        if (total != accept + reject) {
            $("#validationPopUp").show();
            e.preventDefault();
        } else {
            var remarks = $('.QARevised[style="display:flex"]');
            var isRemarkEmpty = false;

            for (var i = 0; i < remarks.length; i++) {
                if ($(remarks[i]).val() == "")
                    isRemarkEmpty = true;
            }
            if (isRemarkEmpty) {
                $("#validationPopUp").show();
                e.preventDefault();
            }
        }
    });

    validationPopUp = function () {
        $("#validationPopUp").hide();
    };

</script>
